#!/usr/bin/env ruby
require 'rbg'

def die
  puts "Usage: rbg run|start|stop|reload [-c config_file] [-E environment]"
  Process.exit(1)
end

begin
  command = nil
  while arg = ARGV.shift
    case arg
    when '-c'
      config_file = ARGV.shift
    when '-E'
      environment = ARGV.shift
    else
      command = arg
    end
  end
  
  if config_file.nil?
    config_file = "ProcessFile"
  end
  
  die unless config_file
  
  case command
  when 'run'
    Rbg.start(config_file, {:background => false, :environment => environment})
  when 'start'
    Rbg.start(config_file, {:background => true, :environment => environment})
  when 'stop'
    Rbg.stop(config_file, {:environment => environment})
  when 'reload', 'restart'
    Rbg.reload(config_file, {:environment => environment})
  else
    die
  end
rescue Rbg::Error => e
  $stderr.puts "!!! #{e.message}"
  Process.exit(1)
end

